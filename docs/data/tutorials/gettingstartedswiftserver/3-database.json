{"schemaVersion":{"major":0,"patch":0,"minor":3},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/3-database"},"sections":[{"estimatedTimeInMinutes":10,"title":"Integrate a database","content":[{"inlineContent":[{"text":"Use the Fluent ORM to connect a PostgreSQL database to the tutorial app.","type":"text"}],"type":"paragraph"}],"kind":"hero","chapter":"Build a basic Vapor app"},{"kind":"tasks","tasks":[{"anchor":"Set-up-the-infrastructure","contentSection":[{"kind":"contentAndMedia","mediaPosition":"trailing","content":[{"type":"paragraph","inlineContent":[{"text":"Set up the app dependencies.","type":"text"}]}]}],"title":"Set up the infrastructure","stepsSection":[{"type":"step","code":"3-bash.0.txt","runtimePreview":null,"content":[{"inlineContent":[{"inlineContent":[{"type":"text","text":"Run"}],"type":"strong"},{"text":" ","type":"text"},{"code":"% docker compose up postgres","type":"codeVoice"}],"type":"paragraph"}],"caption":[{"inlineContent":[{"text":"Open a new terminal and run docker compose to start a Postgres server.","type":"text"}],"type":"paragraph"}],"media":null}]},{"anchor":"Configure-the-database-tables-and-connection","contentSection":[{"mediaPosition":"trailing","kind":"contentAndMedia","content":[{"inlineContent":[{"type":"text","text":"Create tables with Fluent in code as a Model and then use Migrations in the database. You configure the database connection and learn where to run the migrations for the app."}],"type":"paragraph"}]}],"title":"Configure the database tables and connection","stepsSection":[{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Add"}]},{"type":"text","text":" the Fluent dependencies"}]}],"runtimePreview":null,"media":null,"caption":[{"type":"paragraph","inlineContent":[{"text":"Open ","type":"text"},{"code":"Package.swift","type":"codeVoice"},{"text":" to add the Fluent dependencies to the target.","type":"text"}]}],"code":"3-package.0.swift","type":"step"},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Edit"}]},{"text":" ","type":"text"},{"code":"Database.swift","type":"codeVoice"}]}],"runtimePreview":null,"media":null,"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Change "},{"type":"codeVoice","code":"TODO"},{"type":"text","text":" to a class that will represent a database table.  "},{"type":"strong","inlineContent":[{"type":"text","text":"Note:"}]},{"type":"text","text":" The class is nested in the parent type "},{"type":"codeVoice","code":"DB"},{"type":"text","text":" to provide a namespace for the class."}]}],"code":"3-database.0.swift","type":"step"},{"content":[{"inlineContent":[{"inlineContent":[{"text":"Edit","type":"text"}],"type":"strong"},{"type":"text","text":" the class to conform to a Fluent "},{"code":"Model","type":"codeVoice"},{"type":"text","text":"."}],"type":"paragraph"}],"runtimePreview":null,"media":null,"caption":[{"inlineContent":[{"text":"This enables the class to benefit from default implementations of common database operations.","type":"text"}],"type":"paragraph"}],"code":"3-database.1.swift","type":"step"},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Add"}]},{"type":"text","text":" the "},{"type":"codeVoice","code":"schema"},{"type":"text","text":" property, define an "},{"type":"codeVoice","code":"ID"},{"type":"text","text":", to satisfy the "},{"type":"codeVoice","code":"Model"},{"type":"text","text":" protocol."}]}],"runtimePreview":null,"media":null,"caption":[{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"code":"ID","type":"codeVoice"},{"text":" serves as the primary key of the database, ","type":"text"},{"code":"Field","type":"codeVoice"},{"text":" identifies a column of type string called contents.","type":"text"}]}],"code":"3-database.2.swift","type":"step"},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Create"}]},{"text":" a ","type":"text"},{"code":"Migrations","type":"codeVoice"},{"text":" enum for a namespace","type":"text"}]}],"runtimePreview":null,"media":null,"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Add CreateTODOs, conforming to "},{"type":"codeVoice","code":"AsyncMigration"},{"type":"text","text":" with stubs to provide the migration to create a table."}]}],"code":"3-database.3.swift","type":"step"},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Implement"}]},{"type":"text","text":" the migrations."}],"type":"paragraph"}],"runtimePreview":null,"media":null,"caption":[{"inlineContent":[{"code":"database.schema(_)","type":"codeVoice"},{"text":" and ","type":"text"},{"code":"field(_)","type":"codeVoice"},{"text":" to reference the table, while the ","type":"text"},{"code":"create()","type":"codeVoice"},{"text":" and ","type":"text"},{"code":"delete()","type":"codeVoice"},{"text":" methods do the bulk of the work.","type":"text"}],"type":"paragraph"}],"code":"3-database.4.swift","type":"step"},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Create","type":"text"}]},{"type":"text","text":" a "},{"type":"codeVoice","code":"configureDatabase"},{"type":"text","text":" function"}],"type":"paragraph"}],"runtimePreview":null,"media":null,"caption":[{"inlineContent":[{"text":"The function will configure the connection to the databse and run the migrations.","type":"text"}],"type":"paragraph"}],"code":"3-database.5.swift","type":"step"},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"text":"Define","type":"text"}]},{"type":"text","text":" a URL that provides the connection to the database."}]}],"runtimePreview":null,"media":null,"caption":[{"type":"paragraph","inlineContent":[{"text":"Choose the URL by either reading it from the environment or defaulting to something that would work in most development setups.","type":"text"}]}],"code":"3-database.6.swift","type":"step"},{"content":[{"inlineContent":[{"inlineContent":[{"type":"text","text":"Configure"}],"type":"strong"},{"text":" the function to run the database migrations","type":"text"}],"type":"paragraph"}],"runtimePreview":null,"media":null,"caption":[{"inlineContent":[{"type":"text","text":"The database migrations will create the table."}],"type":"paragraph"}],"code":"3-database.7.swift","type":"step"},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Add","type":"text"}]},{"type":"text","text":" a call to "},{"code":"configureDatabase(app: app)","type":"codeVoice"}],"type":"paragraph"}],"runtimePreview":null,"media":null,"caption":[{"inlineContent":[{"text":"Calling ","type":"text"},{"type":"codeVoice","code":"configureDatabase"},{"text":" with a reference to ","type":"text"},{"type":"codeVoice","code":"app"},{"text":" will connect to the database using the URL and run the migrations before the app initializes the server.","type":"text"}],"type":"paragraph"}],"code":"3-entrypoint.1.swift","type":"step"}]},{"anchor":"Add-the-database-layer-to-the-routes","contentSection":[{"kind":"contentAndMedia","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Build on the OpenAPI stubs built in a previous section to add persistence to your OpenAPI routes."}]}],"mediaPosition":"trailing"}],"title":"Add the database layer to the routes","stepsSection":[{"type":"step","caption":[{"inlineContent":[{"text":"Add a ","type":"text"},{"type":"codeVoice","code":"DB"},{"text":" property, and add imports for ","type":"text"},{"type":"codeVoice","code":"Fluent"},{"text":" and ","type":"text"},{"type":"codeVoice","code":"HTTPTypes"},{"text":".","type":"text"}],"type":"paragraph"}],"media":null,"code":"3-apihandler.0.swift","runtimePreview":null,"content":[{"inlineContent":[{"inlineContent":[{"type":"text","text":"Edit"}],"type":"strong"},{"type":"text","text":" "},{"type":"codeVoice","code":"APIHandler.swift"}],"type":"paragraph"}]},{"type":"step","caption":[{"type":"paragraph","inlineContent":[{"text":"As part of the OpenAPI generated types, we have the stubs of the methods we need to implement for our routes. In the previous chapter, we had returned a 500 status code for the create todo route.","type":"text"}]}],"media":null,"code":"3-apihandler.1.swift","runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"text":"Review","type":"text"}],"type":"strong"},{"text":" the idea for creating a new TODO.","type":"text"}]}]},{"type":"step","caption":[{"inlineContent":[{"text":"Use the ","type":"text"},{"type":"codeVoice","code":"DB.TODO()"},{"text":" method to Instantiate a new TODO object from the database.","type":"text"}],"type":"paragraph"}],"media":null,"code":"3-apihandler.2.swift","runtimePreview":null,"content":[{"inlineContent":[{"inlineContent":[{"type":"text","text":"Implement"}],"type":"strong"},{"text":" the code to read from the postgres database.","type":"text"}],"type":"paragraph"}]},{"type":"step","caption":[{"type":"paragraph","inlineContent":[{"text":"Review the commented code to evalute the idea for listing all of the TODOs from the database.","type":"text"}]}],"media":null,"code":"3-apihandler.3.swift","runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Review"}]},{"type":"text","text":" the idea for listing all the available TODOs."}]}]},{"type":"step","caption":[{"inlineContent":[{"type":"text","text":"Fetch TODOs from the database and store them in an array using the code on the right."}],"type":"paragraph"}],"media":null,"code":"3-apihandler.4.swift","runtimePreview":null,"content":[{"inlineContent":[{"inlineContent":[{"text":"Implement","type":"text"}],"type":"strong"},{"type":"text","text":" fetching and returning the TODOs from the database."}],"type":"paragraph"}]},{"type":"step","caption":[{"type":"paragraph","inlineContent":[{"text":"Add the database as a parameter to ","type":"text"},{"type":"codeVoice","code":"APIHandler"},{"text":".","type":"text"}]}],"media":null,"code":"3-serverservice.1.swift","runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"text":"Edit","type":"text"}]},{"type":"text","text":" "},{"type":"codeVoice","code":"ServerService.swift"},{"type":"text","text":"."}]}]}]},{"anchor":"Run-and-test-the-code","contentSection":[{"kind":"contentAndMedia","mediaPosition":"trailing","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Using a terminal, run the updated Vapor app and try it out!"}]}]}],"title":"Run and test the code","stepsSection":[{"runtimePreview":null,"content":[{"inlineContent":[{"inlineContent":[{"text":"Run","type":"text"}],"type":"strong"},{"text":" ","type":"text"},{"code":"% swift run SwiftServerTodos","type":"codeVoice"}],"type":"paragraph"}],"code":"3-bash-swiftrun.0.txt","type":"step","media":null,"caption":[{"inlineContent":[{"text":"To test your work, run the commands on the right in 2 separate terminals.","type":"text"},{"text":" ","type":"text"},{"text":"In this first terminal, run the server.","type":"text"}],"type":"paragraph"}]},{"runtimePreview":null,"content":[{"inlineContent":[{"inlineContent":[{"type":"text","text":"Run"}],"type":"strong"},{"text":" ","type":"text"},{"code":"% curl -i -X POST \\ -H \"Content-Type: application\/json\" \\ -d '{ \"contents\": \"my first todo\" }' \\ localhost:8080\/api\/todos","type":"codeVoice"}],"type":"paragraph"}],"code":"3-bash-curl.0.txt","type":"step","media":null,"caption":[{"inlineContent":[{"text":"In a second terminal, run a ","type":"text"},{"code":"curl","type":"codeVoice"},{"text":" HTTP ","type":"text"},{"code":"POST","type":"codeVoice"},{"text":" request to create a TODO.","type":"text"}],"type":"paragraph"}]},{"runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Review"}]},{"type":"text","text":" the output in the second terminal."}]}],"code":"3-bash-curl.1.txt","type":"step","media":null,"caption":[{"type":"paragraph","inlineContent":[{"text":"The output includes ","type":"text"},{"type":"codeVoice","code":"HTTP\/1.1 201 Created"},{"text":" and shows the new TODO created.","type":"text"}]}]},{"runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"text":"Run","type":"text"}]},{"type":"text","text":" "},{"type":"codeVoice","code":"% curl localhost:8080\/api\/todos"}]}],"code":"3-bash-curl.2.txt","type":"step","media":null,"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"After creating the new TODO, make a "},{"code":"GET","type":"codeVoice"},{"type":"text","text":" request to retrieve all the TODOs."}]}]},{"runtimePreview":null,"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Review"}]},{"type":"text","text":" the output"}],"type":"paragraph"}],"code":"3-bash-curl.3.txt","type":"step","media":null,"caption":[{"inlineContent":[{"text":"You should see the todo you created earlier.","type":"text"}],"type":"paragraph"}]}]}]},{"title":"Review and where to go next","action":{"overridingTitle":"Read article","overridingTitleInlineContent":[{"text":"Read article","type":"text"}],"identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/4-wrapup","isActive":true,"type":"reference"},"featuredEyebrow":"Article","kind":"callToAction","abstract":[{"text":"Review what you built and where to find resources to build something you can ship to production.","type":"text"}]}],"kind":"project","metadata":{"title":"Integrate a database","categoryPathComponent":"getting-started-swift-server","category":"Get Started with Swift Server","role":"project"},"variants":[{"paths":["\/tutorials\/gettingstartedswiftserver\/3-database"],"traits":[{"interfaceLanguage":"swift"}]}],"hierarchy":{"modules":[{"projects":[{"sections":[{"kind":"task","reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/0-setup#Verify-installed-tools"},{"kind":"task","reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/0-setup#Clone-and-build-the-tutorial-repository"}],"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/0-setup"}],"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/getting-started-swift-server\/Before-you-begin"},{"projects":[{"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/1-introduction","sections":[{"kind":"task","reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/1-introduction#Explore-the-parts-of-a-basic-app"}]},{"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/2-openapi","sections":[{"kind":"task","reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/2-openapi#Add-an-OpenAPI-document"},{"kind":"task","reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/2-openapi#OpenAPI-generator"},{"kind":"task","reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/2-openapi#Configure-Vapor-to-use-the-API-handler"}]},{"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/3-database","sections":[{"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/3-database#Set-up-the-infrastructure","kind":"task"},{"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/3-database#Configure-the-database-tables-and-connection","kind":"task"},{"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/3-database#Add-the-database-layer-to-the-routes","kind":"task"},{"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/3-database#Run-and-test-the-code","kind":"task"}]}],"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/getting-started-swift-server\/Build-a-basic-Vapor-app"},{"projects":[{"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/4-wrapup","sections":[{"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/4-wrapup#Summary","kind":"heading"},{"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/4-wrapup#Review","kind":"heading"},{"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/4-wrapup#Where-do-I-go-from-here","kind":"heading"}]}],"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/getting-started-swift-server\/Review-and-next-steps"}],"paths":[["doc:\/\/com.apple.ASE.getting-started\/tutorials\/getting-started-swift-server","doc:\/\/com.apple.ASE.getting-started\/tutorials\/getting-started-swift-server\/$volume","doc:\/\/com.apple.ASE.getting-started\/tutorials\/getting-started-swift-server\/Build-a-basic-Vapor-app"]],"reference":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/getting-started-swift-server"},"references":{"3-bash-curl.0.txt":{"fileName":"Terminal 2","identifier":"3-bash-curl.0.txt","type":"file","fileType":"","syntax":"","highlights":[],"content":["% curl -i -X POST \\","-H \"Content-Type: application\/json\" \\","-d '{ \"contents\": \"my first todo\" }' \\","localhost:8080\/api\/todos"]},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/1-introduction":{"type":"topic","url":"\/tutorials\/gettingstartedswiftserver\/1-introduction","kind":"project","title":"Introduction","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/1-introduction","abstract":[{"text":"The tutorial example contains a Package.swift file that defines the dependencies and targets for the app, as well as a Sources directory with starter files. The finished tutorial is also provided in the Completed folder.","type":"text"}],"estimatedTime":"5min","role":"project"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/4-wrapup#Where-do-I-go-from-here":{"title":"Where do I go from here?","abstract":[{"type":"text","text":"Review what you built and where to find resources to build something you can ship to production."}],"type":"section","url":"\/tutorials\/gettingstartedswiftserver\/4-wrapup#Where-do-I-go-from-here","kind":"section","role":"pseudoSymbol","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/4-wrapup#Where-do-I-go-from-here"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/4-wrapup#Summary":{"kind":"section","abstract":[{"text":"Review what you built and where to find resources to build something you can ship to production.","type":"text"}],"title":"Summary","type":"section","role":"pseudoSymbol","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/4-wrapup#Summary","url":"\/tutorials\/gettingstartedswiftserver\/4-wrapup#Summary"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/2-openapi#Add-an-OpenAPI-document":{"kind":"section","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/2-openapi#Add-an-OpenAPI-document","url":"\/tutorials\/gettingstartedswiftserver\/2-openapi#Add-an-OpenAPI-document","type":"section","abstract":[{"type":"text","text":"Learn how to add an OpenAPI document, generate server stubs using the OpenAPI plugin, and integrate the generated code into the app."}],"title":"Add an OpenAPI document","role":"pseudoSymbol"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/0-setup#Clone-and-build-the-tutorial-repository":{"type":"section","kind":"section","title":"Clone and build the tutorial repository","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/0-setup#Clone-and-build-the-tutorial-repository","url":"\/tutorials\/gettingstartedswiftserver\/0-setup#Clone-and-build-the-tutorial-repository","role":"pseudoSymbol","abstract":[{"text":"Ensure you have the right tools and example code before learning how to write your Swift server application.","type":"text"}]},"3-database.4.swift":{"fileName":"Database.swift","identifier":"3-database.4.swift","content":["import Fluent","import FluentPostgresDriver","import Foundation","import Vapor","","enum DB {","    final class TODO: Model, @unchecked Sendable {","        static let schema = \"todos\"","","        @ID(custom: \"id\", generatedBy: .user)","        var id: String?","","        @Field(key: \"contents\")","        var contents: String","    }","}","","enum Migrations {","    struct CreateTODOs: AsyncMigration {","        func prepare(on database: Database) async throws {","            try await database.schema(DB.TODO.schema)","                .field(\"id\", .string, .identifier(auto: false))","                .field(\"contents\", .string, .required)","                .create()","        }","        ","        func revert(on database: Database) async throws {","            try await database","                .schema(DB.TODO.schema)","                .delete()","        }","    }","}"],"syntax":"swift","type":"file","fileType":"swift","highlights":[{"line":21},{"line":22},{"line":23},{"line":24},{"line":28},{"line":29},{"line":30}]},"doc://com.apple.ASE.getting-started/tutorials/getting-started-swift-server/Before-you-begin":{"abstract":[],"role":"article","type":"topic","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/getting-started-swift-server\/Before-you-begin","url":"\/tutorials\/getting-started-swift-server\/before-you-begin","kind":"article","title":"Before you begin"},"3-database.7.swift":{"type":"file","syntax":"swift","content":["import Fluent","import FluentPostgresDriver","import Foundation","import Vapor","","func configureDatabase(app: Application) async throws {","    let postgresURL = try getOptionalURLEnvVar(\"POSTGRES_URL\")","        ?? URL(string: \"postgres:\/\/postgres@localhost:5432\/postgres?sslmode=disable\")!","    try app.databases.use(.postgres(url: postgresURL), as: .psql)","","    app.migrations.add([","        Migrations.CreateTODOs()","    ])","    try await app.autoMigrate()","}","","enum DB {","    final class TODO: Model, @unchecked Sendable {","        static let schema = \"todos\"","","        @ID(custom: \"id\", generatedBy: .user)","        var id: String?","","        @Field(key: \"contents\")","        var contents: String","    }","}","","enum Migrations {","    struct CreateTODOs: AsyncMigration {","        func prepare(on database: Database) async throws {","            try await database.schema(DB.TODO.schema)","                .field(\"id\", .string, .identifier(auto: false))","                .field(\"contents\", .string, .required)","                .create()","        }","        ","        func revert(on database: Database) async throws {","            try await database","                .schema(DB.TODO.schema)","                .delete()","        }","    }","}"],"fileType":"swift","highlights":[{"line":10},{"line":11},{"line":12},{"line":13},{"line":14}],"identifier":"3-database.7.swift","fileName":"Database.swift"},"doc://com.apple.ASE.getting-started/tutorials/getting-started-swift-server/Build-a-basic-Vapor-app":{"url":"\/tutorials\/getting-started-swift-server\/build-a-basic-vapor-app","type":"topic","title":"Build a basic Vapor app","kind":"article","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/getting-started-swift-server\/Build-a-basic-Vapor-app","role":"article","abstract":[]},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/3-database#Add-the-database-layer-to-the-routes":{"url":"\/tutorials\/gettingstartedswiftserver\/3-database#Add-the-database-layer-to-the-routes","type":"section","role":"pseudoSymbol","abstract":[{"text":"Use the Fluent ORM to connect a PostgreSQL database to the tutorial app.","type":"text"}],"kind":"section","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/3-database#Add-the-database-layer-to-the-routes","title":"Add the database layer to the routes"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/2-openapi":{"type":"topic","abstract":[{"text":"Learn how to add an OpenAPI document, generate server stubs using the OpenAPI plugin, and integrate the generated code into the app.","type":"text"}],"role":"project","url":"\/tutorials\/gettingstartedswiftserver\/2-openapi","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/2-openapi","estimatedTime":"10min","title":"Specify routes using OpenAPI","kind":"project"},"3-serverservice.1.swift":{"fileType":"swift","type":"file","fileName":"ServerService.swift","syntax":"swift","identifier":"3-serverservice.1.swift","content":["import OpenAPIVapor","import ServiceLifecycle","import Vapor","","func configureServer(_ app: Application) async throws -> ServerService {","    app.middleware.use(RequestLoggerInjectionMiddleware())","","    \/\/ A health endpoint.","    app.get(\"health\") { _ in","        \"ok\\n\"","    }","","    \/\/ Create app state.","    let handler = APIHandler(db: app.db)","","    \/\/ Register the generated handlers.","    let transport = VaporTransport(routesBuilder: app)","    try handler.registerHandlers(","        on: transport,","        serverURL: Servers.Server1.url()","    )","","    return ServerService(app: app)","}","","struct ServerService: Service {","    var app: Application","    func run() async throws {","        try await app.execute()","    }","}"],"highlights":[{"line":14}]},"3-database.2.swift":{"identifier":"3-database.2.swift","highlights":[{"line":8},{"line":9},{"line":10},{"line":11},{"line":12},{"line":13},{"line":14}],"syntax":"swift","content":["import Fluent","import FluentPostgresDriver","import Foundation","import Vapor","","enum DB {","    final class TODO: Model, @unchecked Sendable {","        static let schema = \"todos\"","","        @ID(custom: \"id\", generatedBy: .user)","        var id: String?","","        @Field(key: \"contents\")","        var contents: String","    }","}"],"type":"file","fileType":"swift","fileName":"Database.swift"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/4-wrapup":{"estimatedTime":"5min","url":"\/tutorials\/gettingstartedswiftserver\/4-wrapup","type":"topic","role":"article","title":"Review and where to go next","abstract":[{"type":"text","text":"Review what you built and where to find resources to build something you can ship to production."}],"kind":"article","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/4-wrapup"},"3-apihandler.1.swift":{"identifier":"3-apihandler.1.swift","fileName":"APIHandler.swift","content":["import Fluent","import HTTPTypes","import Foundation","import OpenAPIRuntime","","struct APIHandler: APIProtocol {","    ","    var db: Database","    ","    func listTODOs(","        _ input: Operations.ListTODOs.Input","    ) async throws -> Operations.ListTODOs.Output {","        .undocumented(statusCode: 500, .init())","    }","","    func createTODO(","        _ input: Operations.CreateTODO.Input","    ) async throws -> Operations.CreateTODO.Output {","        \/\/ Exercise:","        \/\/ 0. uncomment switch condition","        \/\/ switch input.body {","        \/\/ case .json(let todo):","","        \/\/ 1. Create new ID string using UUID","        \/\/ https:\/\/developer.apple.com\/documentation\/foundation\/uuid\/uuidstring","","        \/\/ 2. Instantiate a new TODO object from the database with DB.TODO().","        \/\/    Populate the fields (id and contents)","","        \/\/ 3. Save the value","        ","        \/\/ 4. Uncomment to return the response","        \/\/ return .created(.init(body: .json(.init(","        \/\/     id: newId,","        \/\/     contents: contents","        \/\/ ))))","        \/\/ }","","        \/\/ Exercise: Remove this after above logic is completed","        .undocumented(statusCode: 500, .init())","    }","","    func getTODODetail(","        _ input: Operations.GetTODODetail.Input","    ) async throws -> Operations.GetTODODetail.Output {","        .undocumented(statusCode: 500, .init())","    }","","    func deleteTODO(","        _ input: Operations.DeleteTODO.Input","    ) async throws -> Operations.DeleteTODO.Output {","        .undocumented(statusCode: 500, .init())","    }","}",""],"syntax":"swift","type":"file","fileType":"swift","highlights":[{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25},{"line":26},{"line":27},{"line":28},{"line":29},{"line":30},{"line":31},{"line":32},{"line":33},{"line":34},{"line":35},{"line":36},{"line":37},{"line":38},{"line":39},{"line":55}]},"3-bash-curl.2.txt":{"fileName":"Terminal 2","content":["% curl -i -X POST \\","-H \"Content-Type: application\/json\" \\","-d '{ \"contents\": \"my first todo\" }' \\","localhost:8080\/api\/todos","","HTTP\/1.1 201 Created","Content-Type: application\/json; charset=utf-8","content-length: 83","connection: keep-alive","date: Thu, 15 May 2025 04:59:34 GMT","","{","  \"contents\" : \"my first todo\",","  \"id\" : \"5A91C1AA-293C-4298-B725-01333BFF2544\"","}","","% curl localhost:8080\/api\/todos"],"syntax":"","identifier":"3-bash-curl.2.txt","highlights":[{"line":16},{"line":17}],"fileType":"","type":"file"},"3-database.3.swift":{"content":["import Fluent","import FluentPostgresDriver","import Foundation","import Vapor","","enum DB {","    final class TODO: Model, @unchecked Sendable {","        static let schema = \"todos\"","","        @ID(custom: \"id\", generatedBy: .user)","        var id: String?","","        @Field(key: \"contents\")","        var contents: String","    }","}","","enum Migrations {","    struct CreateTODOs: AsyncMigration {","        func prepare(on database: Database) async throws {","            \/\/ Exercise: add table creation logic","        }","        ","        func revert(on database: Database) async throws {","            \/\/ Exercise: add table deletion logic","        }","    }","}"],"identifier":"3-database.3.swift","highlights":[{"line":17},{"line":18},{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25},{"line":26},{"line":27},{"line":28}],"type":"file","syntax":"swift","fileType":"swift","fileName":"Database.swift"},"3-database.1.swift":{"syntax":"swift","type":"file","fileType":"swift","identifier":"3-database.1.swift","content":["import Fluent","import FluentPostgresDriver","import Foundation","import Vapor","","enum DB {","    final class TODO: Model, @unchecked Sendable {","        \/\/ Exercise: add in the database module","    }","}"],"highlights":[{"line":7}],"fileName":"Database.swift"},"3-package.0.swift":{"fileName":"Database.swift","fileType":"swift","identifier":"3-package.0.swift","content":["\/\/ swift-tools-version: 6.1","","import PackageDescription","","let package = Package(","    name: \"swift-server-todos\",","    platforms: [","        .macOS(.v15)","    ],","    dependencies: [","        \/\/ Server scaffolding","        .package(url: \"https:\/\/github.com\/vapor\/vapor\", from: \"4.0.0\"),","        .package(url: \"https:\/\/github.com\/swift-server\/swift-service-lifecycle\", from: \"2.1.0\"),","        .package(url: \"https:\/\/github.com\/apple\/swift-openapi-generator\", from: \"1.0.0\"),","        .package(url: \"https:\/\/github.com\/apple\/swift-openapi-runtime\", from: \"1.0.0\"),","        .package(url: \"https:\/\/github.com\/swift-server\/swift-openapi-vapor\", from: \"1.0.0\"),","","        \/\/ Telemetry","        .package(url: \"https:\/\/github.com\/apple\/swift-log\", from: \"1.5.2\"),","","        \/\/ Database","        .package(url: \"https:\/\/github.com\/vapor\/fluent.git\", from: \"4.0.0\"),","        .package(url: \"https:\/\/github.com\/vapor\/fluent-postgres-driver.git\", from: \"2.0.0\"),","    ],","    targets: [","        .executableTarget(","            name: \"SwiftServerTodos\",","            dependencies: [","                \/\/ Server scaffolding","                .product(name: \"Vapor\", package: \"vapor\"),","                .product(name: \"ServiceLifecycle\", package: \"swift-service-lifecycle\"),","                .product(name: \"OpenAPIRuntime\", package: \"swift-openapi-runtime\"),","                .product(name: \"OpenAPIVapor\", package: \"swift-openapi-vapor\"),","","                \/\/ Telemetry","                .product(name: \"Logging\", package: \"swift-log\"),","","                \/\/ Database","                .product(name: \"Fluent\", package: \"fluent\"),","                .product(name: \"FluentPostgresDriver\", package: \"fluent-postgres-driver\"),","            ],","            plugins: [","                .plugin(name: \"OpenAPIGenerator\", package: \"swift-openapi-generator\")","            ]","        )","    ]",")"],"type":"file","highlights":[{"line":37},{"line":38},{"line":39},{"line":40}],"syntax":"swift"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/0-setup#Verify-installed-tools":{"abstract":[{"type":"text","text":"Ensure you have the right tools and example code before learning how to write your Swift server application."}],"url":"\/tutorials\/gettingstartedswiftserver\/0-setup#Verify-installed-tools","type":"section","title":"Verify installed tools","kind":"section","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/0-setup#Verify-installed-tools","role":"pseudoSymbol"},"doc://com.apple.ASE.getting-started/tutorials/getting-started-swift-server":{"role":"overview","title":"Explore Swift on the server by building a Vapor app","type":"topic","kind":"overview","abstract":[{"type":"text","text":"Learn about cloud services in Swift by building and extending a Vapor app."}],"identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/getting-started-swift-server","url":"\/tutorials\/getting-started-swift-server"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/0-setup":{"kind":"project","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/0-setup","abstract":[{"type":"text","text":"Ensure you have the right tools and example code before learning how to write your Swift server application."}],"type":"topic","role":"project","estimatedTime":"5min","url":"\/tutorials\/gettingstartedswiftserver\/0-setup","title":"Set up your development environment"},"3-bash-curl.3.txt":{"content":["% curl -i -X POST \\","-H \"Content-Type: application\/json\" \\","-d '{ \"contents\": \"my first todo\" }' \\","localhost:8080\/api\/todos","","HTTP\/1.1 201 Created","Content-Type: application\/json; charset=utf-8","content-length: 83","connection: keep-alive","date: Thu, 15 May 2025 04:59:34 GMT","","{","  \"contents\" : \"my first todo\",","  \"id\" : \"5A91C1AA-293C-4298-B725-01333BFF2544\"","}","","% curl localhost:8080\/api\/todos","{","  \"items\" : [","    {","      \"contents\" : \"my first todo\",","      \"id\" : \"5A91C1AA-293C-4298-B725-01333BFF2544\"","    }","  ]","}"],"syntax":"","highlights":[{"line":18},{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25}],"fileType":"","fileName":"Terminal 2","identifier":"3-bash-curl.3.txt","type":"file"},"3-bash-curl.1.txt":{"content":["% curl -i -X POST \\","-H \"Content-Type: application\/json\" \\","-d '{ \"contents\": \"my first todo\" }' \\","localhost:8080\/api\/todos","","HTTP\/1.1 201 Created","Content-Type: application\/json; charset=utf-8","content-length: 83","connection: keep-alive","date: Thu, 15 May 2025 04:59:34 GMT","","{","  \"contents\" : \"my first todo\",","  \"id\" : \"5A91C1AA-293C-4298-B725-01333BFF2544\"","}"],"fileName":"Terminal 2","type":"file","highlights":[{"line":5},{"line":6},{"line":7},{"line":8},{"line":9},{"line":10},{"line":11},{"line":12},{"line":13},{"line":14},{"line":15}],"syntax":"","identifier":"3-bash-curl.1.txt","fileType":""},"3-apihandler.0.swift":{"type":"file","syntax":"swift","content":["import Fluent","import HTTPTypes","import Foundation","import OpenAPIRuntime","","struct APIHandler: APIProtocol {","    ","    var db: Database","    ","    func listTODOs(","        _ input: Operations.ListTODOs.Input","    ) async throws -> Operations.ListTODOs.Output {","        .undocumented(statusCode: 500, .init())","    }","","    func createTODO(","        _ input: Operations.CreateTODO.Input","    ) async throws -> Operations.CreateTODO.Output {","        .undocumented(statusCode: 500, .init())","    }","","    func getTODODetail(","        _ input: Operations.GetTODODetail.Input","    ) async throws -> Operations.GetTODODetail.Output {","        .undocumented(statusCode: 500, .init())","    }","","    func deleteTODO(","        _ input: Operations.DeleteTODO.Input","    ) async throws -> Operations.DeleteTODO.Output {","        .undocumented(statusCode: 500, .init())","    }","}"],"fileType":"swift","highlights":[{"line":1},{"line":2},{"line":7},{"line":8},{"line":9}],"identifier":"3-apihandler.0.swift","fileName":"APIHandler.swift"},"doc://com.apple.ASE.getting-started/tutorials/getting-started-swift-server/Review-and-next-steps":{"kind":"article","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/getting-started-swift-server\/Review-and-next-steps","role":"article","type":"topic","title":"Review and next steps","url":"\/tutorials\/getting-started-swift-server\/review-and-next-steps","abstract":[]},"3-bash-swiftrun.0.txt":{"content":[" % swift run SwiftServerTodos","Building for debugging...","[1\/1] Write swift-version--61257B8C62E73F86.txt","Build of product 'SwiftServerTodos' complete! (0.45s)","[ INFO ] [Migrator] Starting prepare [database-id: psql, migration: SwiftServerTodos.Migrations.CreateTODOs]","[ INFO ] [Migrator] Finished prepare [database-id: psql, migration: SwiftServerTodos.Migrations.CreateTODOs]","[ NOTICE ] Server started on http:\/\/0.0.0.0:8080"],"identifier":"3-bash-swiftrun.0.txt","type":"file","syntax":"","highlights":[],"fileName":"Terminal 1","fileType":""},"3-entrypoint.1.swift":{"type":"file","content":["import ServiceLifecycle","import Vapor","","@main","struct Entrypoint {","    static func main() async throws {","        var env = try Environment.detect()","","        \/\/ Configure telemetry","        try await configureTelemetryServices(env: &env)","","        \/\/ Create the server","        let app = try await Vapor.Application.make()","        app.http.server.configuration.address = .hostname(","            getOptionalEnvVar(\"SERVER_ADDRESS\") ?? \"0.0.0.0\",","            port: try getOptionalEnvVar(\"SERVER_PORT\") ?? 8080","        )","","        \/\/ Configure the database","        try await configureDatabase(app: app)","","        \/\/ Configure the server","        let serverService = try await configureServer(app)","","        \/\/ Start the service group, which spins up all the service above","        let services: [Service] = [serverService]","        let serviceGroup = ServiceGroup(","            services: services,","            gracefulShutdownSignals: [.sigint],","            cancellationSignals: [.sigterm],","            logger: app.logger","        )","        try await serviceGroup.run()","    }","}"],"syntax":"swift","identifier":"3-entrypoint.1.swift","fileName":"Entrypoint.swift","highlights":[{"line":19},{"line":20}],"fileType":"swift"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/3-database":{"kind":"project","abstract":[{"type":"text","text":"Use the Fluent ORM to connect a PostgreSQL database to the tutorial app."}],"role":"project","estimatedTime":"10min","type":"topic","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/3-database","url":"\/tutorials\/gettingstartedswiftserver\/3-database","title":"Integrate a database"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/1-introduction#Explore-the-parts-of-a-basic-app":{"kind":"section","url":"\/tutorials\/gettingstartedswiftserver\/1-introduction#Explore-the-parts-of-a-basic-app","type":"section","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/1-introduction#Explore-the-parts-of-a-basic-app","abstract":[{"text":"The tutorial example contains a Package.swift file that defines the dependencies and targets for the app, as well as a Sources directory with starter files. The finished tutorial is also provided in the Completed folder.","type":"text"}],"title":"Explore the parts of a basic app","role":"pseudoSymbol"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/3-database#Set-up-the-infrastructure":{"identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/3-database#Set-up-the-infrastructure","title":"Set up the infrastructure","url":"\/tutorials\/gettingstartedswiftserver\/3-database#Set-up-the-infrastructure","kind":"section","role":"pseudoSymbol","abstract":[{"type":"text","text":"Use the Fluent ORM to connect a PostgreSQL database to the tutorial app."}],"type":"section"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/2-openapi#Configure-Vapor-to-use-the-API-handler":{"type":"section","kind":"section","title":"Configure Vapor to use the API handler","abstract":[{"type":"text","text":"Learn how to add an OpenAPI document, generate server stubs using the OpenAPI plugin, and integrate the generated code into the app."}],"identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/2-openapi#Configure-Vapor-to-use-the-API-handler","role":"pseudoSymbol","url":"\/tutorials\/gettingstartedswiftserver\/2-openapi#Configure-Vapor-to-use-the-API-handler"},"3-apihandler.2.swift":{"identifier":"3-apihandler.2.swift","fileName":"APIHandler.swift","content":["import Fluent","import HTTPTypes","import Foundation","import OpenAPIRuntime","","struct APIHandler: APIProtocol {","    ","    var db: Database","    ","    func listTODOs(","        _ input: Operations.ListTODOs.Input","    ) async throws -> Operations.ListTODOs.Output {","        .undocumented(statusCode: 500, .init())","    }","","    func createTODO(","        _ input: Operations.CreateTODO.Input","    ) async throws -> Operations.CreateTODO.Output {","        switch input.body {","        case .json(let todo):","            \/\/ 1. Create new ID string using UUID","            let newId = UUID().uuidString","            let contents = todo.contents","","            \/\/ 2. Instantiate a new TODO object from the database with DB.TODO()","            \/\/    Populate the fields (id and contents)","            let dbTodo = DB.TODO()","            dbTodo.id = newId","            dbTodo.contents = contents","","            \/\/ 3. Save the value","            try await dbTodo.save(on: db)","","            return .created(","                .init(","                    body: .json(","                        .init(","                            id: newId,","                            contents: contents","                        )","                    )","                )","            )","        }","    }","","    func getTODODetail(","        _ input: Operations.GetTODODetail.Input","    ) async throws -> Operations.GetTODODetail.Output {","        .undocumented(statusCode: 500, .init())","    }","","    func deleteTODO(","        _ input: Operations.DeleteTODO.Input","    ) async throws -> Operations.DeleteTODO.Output {","        .undocumented(statusCode: 500, .init())","    }","}",""],"syntax":"swift","type":"file","fileType":"swift","highlights":[{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":25},{"line":26},{"line":27},{"line":28},{"line":29},{"line":31},{"line":32},{"line":34},{"line":35},{"line":36},{"line":37},{"line":38},{"line":39},{"line":40},{"line":41},{"line":42},{"line":43},{"line":44}]},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/4-wrapup#Review":{"identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/4-wrapup#Review","kind":"section","abstract":[{"type":"text","text":"Review what you built and where to find resources to build something you can ship to production."}],"type":"section","role":"pseudoSymbol","title":"Review","url":"\/tutorials\/gettingstartedswiftserver\/4-wrapup#Review"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/3-database#Run-and-test-the-code":{"identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/3-database#Run-and-test-the-code","kind":"section","role":"pseudoSymbol","title":"Run and test the code","url":"\/tutorials\/gettingstartedswiftserver\/3-database#Run-and-test-the-code","abstract":[{"text":"Use the Fluent ORM to connect a PostgreSQL database to the tutorial app.","type":"text"}],"type":"section"},"3-database.5.swift":{"identifier":"3-database.5.swift","fileName":"Database.swift","syntax":"swift","content":["import Fluent","import FluentPostgresDriver","import Foundation","import Vapor","","func configureDatabase(app: Application) async throws {","    \/\/ Exercise: configure the database connection","}","","enum DB {","    final class TODO: Model, @unchecked Sendable {","        static let schema = \"todos\"","","        @ID(custom: \"id\", generatedBy: .user)","        var id: String?","","        @Field(key: \"contents\")","        var contents: String","    }","}","","enum Migrations {","    struct CreateTODOs: AsyncMigration {","        func prepare(on database: Database) async throws {","            try await database.schema(DB.TODO.schema)","                .field(\"id\", .string, .identifier(auto: false))","                .field(\"contents\", .string, .required)","                .create()","        }","        ","        func revert(on database: Database) async throws {","            try await database","                .schema(DB.TODO.schema)","                .delete()","        }","    }","}"],"type":"file","fileType":"swift","highlights":[{"line":6},{"line":7},{"line":8},{"line":9}]},"3-apihandler.3.swift":{"content":["import Fluent","import HTTPTypes","import Foundation","import OpenAPIRuntime","","struct APIHandler: APIProtocol {","    ","    var db: Database","    ","    func listTODOs(","        _ input: Operations.ListTODOs.Input","    ) async throws -> Operations.ListTODOs.Output {","        \/\/ Exercise:","        \/\/ 1. Fetch todos from database","","        \/\/ 2. Serialize them to the TODO Detail array","        \/\/      [Components.Schemas.TODODetail]","","        \/\/ 3. Uncomment the return statement with the response below","        \/\/ return .ok(.init(body: .json(.init(items: apiTodos))))","","        \/\/ Exercise: Remove this after above logic is completed","        .undocumented(statusCode: 500, .init())","    }","","    func createTODO(","        _ input: Operations.CreateTODO.Input","    ) async throws -> Operations.CreateTODO.Output {","        switch input.body {","        case .json(let todo):","            \/\/ 1. Create new ID string using UUID","            let newId = UUID().uuidString","            let contents = todo.contents","","            \/\/ 2. Instantiate a new TODO object from the database with DB.TODO()","            \/\/    Populate the fields (id and contents)","            let dbTodo = DB.TODO()","            dbTodo.id = newId","            dbTodo.contents = contents","","            \/\/ 3. Save the value","            try await dbTodo.save(on: db)","","            return .created(","                .init(","                    body: .json(","                        .init(","                            id: newId,","                            contents: contents","                        )","                    )","                )","            )","        }","    }","","    func getTODODetail(","        _ input: Operations.GetTODODetail.Input","    ) async throws -> Operations.GetTODODetail.Output {","        .undocumented(statusCode: 500, .init())","    }","","    func deleteTODO(","        _ input: Operations.DeleteTODO.Input","    ) async throws -> Operations.DeleteTODO.Output {","        .undocumented(statusCode: 500, .init())","    }","}",""],"highlights":[{"line":13},{"line":14},{"line":15},{"line":16},{"line":17},{"line":18},{"line":19},{"line":20},{"line":21},{"line":22}],"fileType":"swift","syntax":"swift","fileName":"APIHandler.swift","type":"file","identifier":"3-apihandler.3.swift"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/2-openapi#OpenAPI-generator":{"url":"\/tutorials\/gettingstartedswiftserver\/2-openapi#OpenAPI-generator","title":"OpenAPI generator","abstract":[{"type":"text","text":"Learn how to add an OpenAPI document, generate server stubs using the OpenAPI plugin, and integrate the generated code into the app."}],"kind":"section","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/2-openapi#OpenAPI-generator","type":"section","role":"pseudoSymbol"},"doc://com.apple.ASE.getting-started/tutorials/GettingStartedSwiftServer/3-database#Configure-the-database-tables-and-connection":{"type":"section","abstract":[{"type":"text","text":"Use the Fluent ORM to connect a PostgreSQL database to the tutorial app."}],"url":"\/tutorials\/gettingstartedswiftserver\/3-database#Configure-the-database-tables-and-connection","title":"Configure the database tables and connection","identifier":"doc:\/\/com.apple.ASE.getting-started\/tutorials\/GettingStartedSwiftServer\/3-database#Configure-the-database-tables-and-connection","kind":"section","role":"pseudoSymbol"},"3-bash.0.txt":{"fileName":"Terminal","identifier":"3-bash.0.txt","type":"file","fileType":"","syntax":"","highlights":[],"content":["% docker compose up postgres","[+] Running 2\/2"," ⠿ Network swiftservertodos_default       Created              0.1s"," ⠿ Container swiftservertodos-postgres-1  Created              0.1s","Attaching to swiftservertodos-postgres-1","..."]},"3-database.6.swift":{"identifier":"3-database.6.swift","type":"file","content":["import Fluent","import FluentPostgresDriver","import Foundation","import Vapor","","func configureDatabase(app: Application) async throws {","    let postgresURL = try getOptionalURLEnvVar(\"POSTGRES_URL\")","        ?? URL(string: \"postgres:\/\/postgres@localhost:5432\/postgres?sslmode=disable\")!","    try app.databases.use(.postgres(url: postgresURL), as: .psql)","}","","enum DB {","    final class TODO: Model, @unchecked Sendable {","        static let schema = \"todos\"","","        @ID(custom: \"id\", generatedBy: .user)","        var id: String?","","        @Field(key: \"contents\")","        var contents: String","    }","}","","enum Migrations {","    struct CreateTODOs: AsyncMigration {","        func prepare(on database: Database) async throws {","            try await database.schema(DB.TODO.schema)","                .field(\"id\", .string, .identifier(auto: false))","                .field(\"contents\", .string, .required)","                .create()","        }","        ","        func revert(on database: Database) async throws {","            try await database","                .schema(DB.TODO.schema)","                .delete()","        }","    }","}"],"fileName":"Database.swift","syntax":"swift","fileType":"swift","highlights":[{"line":7},{"line":8},{"line":9}]},"3-apihandler.4.swift":{"fileName":"APIHandler.swift","highlights":[{"line":15},{"line":16},{"line":18},{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25}],"type":"file","syntax":"swift","identifier":"3-apihandler.4.swift","fileType":"swift","content":["import Fluent","import HTTPTypes","import Foundation","import OpenAPIRuntime","","struct APIHandler: APIProtocol {","    ","    var db: Database","    ","    func listTODOs(","        _ input: Operations.ListTODOs.Input","    ) async throws -> Operations.ListTODOs.Output {","        \/\/ Exercise:","        \/\/ 1. Fetch todos from database","        let dbTodos = try await db.query(DB.TODO.self).all()","        ","        \/\/ 2. Serialize them to the TODO Detail array","        let apiTodos = try dbTodos.map { todo in","            Components.Schemas.TODODetail(","                id: try todo.requireID(),","                contents: todo.contents","            )","        }","        ","        return .ok(.init(body: .json(.init(items: apiTodos))))","    }","","    func createTODO(","        _ input: Operations.CreateTODO.Input","    ) async throws -> Operations.CreateTODO.Output {","        switch input.body {","        case .json(let todo):","            \/\/ 1. Create new ID string using UUID","            let newId = UUID().uuidString","            let contents = todo.contents","","            \/\/ 2. Instantiate a new TODO object from the database with DB.TODO()","            \/\/    Populate the fields (id and contents)","            let dbTodo = DB.TODO()","            dbTodo.id = newId","            dbTodo.contents = contents","","            \/\/ 3. Save the value","            try await dbTodo.save(on: db)","","            return .created(","                .init(","                    body: .json(","                        .init(","                            id: newId,","                            contents: contents","                        )","                    )","                )","            )","        }","    }","","    func getTODODetail(","        _ input: Operations.GetTODODetail.Input","    ) async throws -> Operations.GetTODODetail.Output {","        .undocumented(statusCode: 500, .init())","    }","","    func deleteTODO(","        _ input: Operations.DeleteTODO.Input","    ) async throws -> Operations.DeleteTODO.Output {","        .undocumented(statusCode: 500, .init())","    }","}",""]},"3-database.0.swift":{"content":["import Fluent","import FluentPostgresDriver","import Foundation","import Vapor","","enum DB {","    final class TODO {","        \/\/ Exercise: add in the database module","    }","}"],"type":"file","fileType":"swift","highlights":[{"line":1},{"line":2},{"line":6},{"line":7},{"line":8},{"line":9}],"identifier":"3-database.0.swift","syntax":"swift","fileName":"Database.swift"}}}